<!DOCTYPE html>
<html>
<head>
    <title>WebRTC Stream</title>
    <style>
        video { 
            width: 100%; 
            max-height: 600px; 
            background: black; 
        }
    </style>
</head>
<body>
    <video id="remoteVideo" autoplay playsinline></video>
    
    <script>
        const video = document.getElementById('remoteVideo');
        let peerConnection;

        function createPeerConnection() {
            peerConnection = new RTCPeerConnection({
                iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' }
                ]
            });

            peerConnection.ontrack = (event) => {
                video.srcObject = event.streams[0];
            };
        }

        function getOfferFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedOffer = urlParams.get('offer');
            
            if (encodedOffer) {
                try {
                    const offerData = JSON.parse(decodeURIComponent(encodedOffer));
                    connectPeer(offerData);
                } catch (error) {
                    console.error('Ошибка декодирования:', error);
                }
            }
        }

        async function connectPeer(offerData) {
            try {
                createPeerConnection();
                
                await peerConnection.setRemoteDescription(
                    new RTCSessionDescription(offerData)
                );

                const answer = await peerConnection.createAnswer();
                await peerConnection.setLocalDescription(answer);

            } catch (error) {
                console.error('Ошибка подключения:', error);
            }
        }

        window.onload = getOfferFromURL;
    </script>
</body>
</html>
